<!DOCTYPE html>
<html lang="en-US">
  <head>
    <title>DOGUS Audit js</title>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <link type="text/css" rel="stylesheet" href="/css/styles.css">
    <script type="text/javascript">
    'use strict';

    // lets create a new app called api you could call it bob
    let api = {
      // api.config is a simple map to the html id
      config: {
        urlId: 'url',
        urlPlusId: 'urlPlus',
        limitId: 'limit',
        adminId: 'adminList',
        linksId: 'linksList',
        scriptsId: 'scriptsList',
        linksCountId: 'linksCount',
        scriptsCountId: 'scriptsCount'
      },
      buildUrl: () => {
        // read the html input fields and return a url to scrape
        let url =  api.getFormValue(api.config.urlId);
        url +=  api.getFormValue(api.config.urlPlusId); // we add the plus input to the url
        let limit =  api.getFormValue(api.config.limitId);
        let urlOut = 'http://localhost:8082/getData/?url=' + url + '&limit=' + limit;
        return urlOut;
      },
      getFormValue: (id) => {
        // simply gets an input value
        return document.getElementById(id).value;
      },
      getPageData: () => {

          let url =  api.buildUrl();
          api.addMessages(api.config.adminId, ['Ajax request sent to : ' + url]);
          axios({
            method:'get',
            url: url,
            responseType:'json'
          })
          .then(function (response) {
            if(response.status === 200){
              let links = response.data.links; // array
              let scripts = response.data.scripts; // array
              let adminMsg = ['Ajax response links=' + links.length + ' scripts=' + scripts.length];

              api.addMessages(api.config.adminId, adminMsg, false);
              api.addMessages(api.config.linksId, links, true); // will add a link
              api.addMessages(api.config.scriptsId, scripts, false);


              document.getElementById(api.config.linksCountId).innerHTML = links.length;
              document.getElementById(api.config.scriptsCountId).innerHTML = scripts.length;

            } else {
              api.addMessages(api.config.adminId, ['Ajax response Error: ' + response.status]);
            }
          })
          .catch(function (error) {
              api.addMessages(api.config.adminId, ['Ajax response catch Error: ' + error]);
          });
      },
      addMessages: (id, messages, link = false) => {
        for(var i = 0; i < messages.length; i++) {
          if(link) {
            let msg =  messages[i];
            messages[i] = '<a onClick="api.updateUrlPlus(this.innerHTML)" href="#">' + msg + '</a>';
          }
          document.getElementById(id).innerHTML += '<li>' + messages[i] +'</li>';
        }
      },
      updateUrlPlus: (urlPlus) => {
        // callback to add the clicked item to the url plus input and search new page
        console.log('urlPlus', urlPlus);
        document.getElementById(api.config.urlPlusId).value = urlPlus;
      }
    };
    </script>
  </head>
  <body style="font-family: Verdana;">
      <input id="url" style="width:250px" value="https://www.w3schools.com" type="text">
      <input id="urlPlus" style="width:150px" value="" type="text">
      <input id="limit" style="width:30px" value="3" type="number">

      <input type="button" onClick="api.getPageData()" value="getPageData">

      <ul id="adminList">Admin</ul>

      <ul id="linksList" style="display: inline-block; width:500px; border:1px solid blue; vertical-align: top">
        <span id="linksCount"></span> Links
      </ul>

      <ul id="scriptsList" style="display: inline-block; width:500px;border:1px solid green; vertical-align: top; margin-left:50px;">
        <span id="scriptsCount"></span> Scripts
      </ul>

  </body>
</html>
