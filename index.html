<!DOCTYPE html>
<html>
  <head>
    <title>DOGUS Audit js</title>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script type="text/javascript">
    'use strict';

    let api = {
      config: {
        urlId: 'url',
        limitId: 'limit',
        adminId: 'adminList',
        linksId: 'linksList',
        scriptsId: 'scriptsList',
        linksCountId: 'linksCount',
        scriptsCountId: 'scriptsCount'
      },
      buildUrl: () => {
        let url =  api.getFormValue(api.config.urlId);
        let limit =  api.getFormValue(api.config.limitId);
        let urlOut = 'http://localhost:8082/getData/?url=' + url + '&limit=' + limit;
        return urlOut;
      },
      getFormValue: (id) => {
        return document.getElementById(id).value;
      },
      getPageData: () => {

          let url =  api.buildUrl();
          api.addMessage(api.config.adminId, 'Ajax request sent to : ' + url);
          axios({
            method:'get',
            url: url,
            responseType:'json'
          })
          .then(function (response) {
            if(response.status === 200){
              let links = response.data.links;
              let scripts = response.data.scripts;

              api.addMessage(api.config.adminId, 'Ajax response links=' + links.length + ' scripts=' + scripts.length);
              api.addMessages(api.config.scriptsId, scripts);
              api.addMessages(api.config.linksId, links);
              
              document.getElementById(api.config.linksCountId).innerHTML = links.length;
              document.getElementById(api.config.scriptsCountId).innerHTML = scripts.length;

            } else {
              api.addMessage(api.config.adminId, 'Ajax response Error: ' + response.status);
            }
          })
          .catch(function (error) {
              api.addMessage(api.config.adminId, 'Ajax response catch Error: ' + error);
          });
      },
      addMessages: (id, messages) => {
        for(var i = 0; i < messages.length; i++) {
          api.addMessage(id, messages[i]);
        }
      },
      addMessage: (id, message) => {
        document.getElementById(id).innerHTML += '<li>' + message +'</li>';
      }
    };
    </script>
  </head>
  <body style="font-family: Verdana;">
      <input id="url" style="width:500px" value="https://www.w3schools.com/" type="text">
      <input id="limit" value="3" type="number">

      <input type="button" onClick="api.getPageData()" value="getPageData">

      <ul id="adminList">Admin</ul>

      <ul id="linksList" style="display: inline-block; width:500px; border:1px solid blue; vertical-align: top">
        <span id="linksCount"></span> Links
      </ul>

      <ul id="scriptsList" style="display: inline-block; width:500px;border:1px solid green; vertical-align: top; margin-left:50px;">
        <span id="scriptsCount"></span> Scripts
      </ul>

  </body>
</html>
